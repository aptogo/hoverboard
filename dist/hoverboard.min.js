!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Hoverboard=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){!function(b,e){"object"==typeof d?c.exports=e():"function"==typeof a&&a.amd?a([],e):b.ensureArray=e()}(this,function(){"use strict";function a(a,b,c){if(0===arguments.length)return[];if(1===arguments.length){if(void 0===a||null===a)return[];if(Array.isArray(a))return a}return Array.prototype.slice.call(arguments)}return a})},{}],2:[function(b,c,d){!function(){"use strict";function b(a,c){return this instanceof b?(this._maxEntries=Math.max(4,a||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),c&&this._initFormat(c),void this.clear()):new b(a,c)}function d(a,b){a.bbox=e(a,0,a.children.length,b)}function e(a,b,c,d){for(var e,h=f(),i=b;c>i;i++)e=a.children[i],g(h,a.leaf?d(e):e.bbox);return h}function f(){return[1/0,1/0,-(1/0),-(1/0)]}function g(a,b){return a[0]=Math.min(a[0],b[0]),a[1]=Math.min(a[1],b[1]),a[2]=Math.max(a[2],b[2]),a[3]=Math.max(a[3],b[3]),a}function h(a,b){return a.bbox[0]-b.bbox[0]}function i(a,b){return a.bbox[1]-b.bbox[1]}function j(a){return(a[2]-a[0])*(a[3]-a[1])}function k(a){return a[2]-a[0]+(a[3]-a[1])}function l(a,b){return(Math.max(b[2],a[2])-Math.min(b[0],a[0]))*(Math.max(b[3],a[3])-Math.min(b[1],a[1]))}function m(a,b){var c=Math.max(a[0],b[0]),d=Math.max(a[1],b[1]),e=Math.min(a[2],b[2]),f=Math.min(a[3],b[3]);return Math.max(0,e-c)*Math.max(0,f-d)}function n(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&b[2]<=a[2]&&b[3]<=a[3]}function o(a,b){return b[0]<=a[2]&&b[1]<=a[3]&&b[2]>=a[0]&&b[3]>=a[1]}function p(a,b,c,d,e){for(var f,g=[b,c];g.length;)c=g.pop(),b=g.pop(),d>=c-b||(f=b+Math.ceil((c-b)/d/2)*d,q(a,b,c,f,e),g.push(b,f,f,c))}function q(a,b,c,d,e){for(var f,g,h,i,j,k,l,m,n;c>b;){for(c-b>600&&(f=c-b+1,g=d-b+1,h=Math.log(f),i=.5*Math.exp(2*h/3),j=.5*Math.sqrt(h*i*(f-i)/f)*(0>g-f/2?-1:1),k=Math.max(b,Math.floor(d-g*i/f+j)),l=Math.min(c,Math.floor(d+(f-g)*i/f+j)),q(a,k,l,d,e)),m=a[d],g=b,n=c,r(a,b,d),e(a[c],m)>0&&r(a,b,c);n>g;){for(r(a,g,n),g++,n--;e(a[g],m)<0;)g++;for(;e(a[n],m)>0;)n--}0===e(a[b],m)?r(a,b,n):(n++,r(a,n,c)),d>=n&&(b=n+1),n>=d&&(c=n-1)}}function r(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}b.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],d=this.toBBox;if(!o(a,b.bbox))return c;for(var e,f,g,h,i=[];b;){for(e=0,f=b.children.length;f>e;e++)g=b.children[e],h=b.leaf?d(g):g.bbox,o(a,h)&&(b.leaf?c.push(g):n(a,h)?this._all(g,c):i.push(g));b=i.pop()}return c},collides:function(a){var b=this.data,c=this.toBBox;if(!o(a,b.bbox))return!1;for(var d,e,f,g,h=[];b;){for(d=0,e=b.children.length;e>d;d++)if(f=b.children[d],g=b.leaf?c(f):f.bbox,o(a,g)){if(b.leaf||n(a,g))return!0;h.push(f)}b=h.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;c>b;b++)this.insert(a[b]);return this}var d=this._build(a.slice(),0,a.length-1,0);if(this.data.children.length)if(this.data.height===d.height)this._splitRoot(this.data,d);else{if(this.data.height<d.height){var e=this.data;this.data=d,d=e}this._insert(d,this.data.height-d.height-1,!0)}else this.data=d;return this},insert:function(a){return a&&this._insert(a,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:f(),leaf:!0},this},remove:function(a){if(!a)return this;for(var b,c,d,e,f=this.data,g=this.toBBox(a),h=[],i=[];f||h.length;){if(f||(f=h.pop(),c=h[h.length-1],b=i.pop(),e=!0),f.leaf&&(d=f.children.indexOf(a),-1!==d))return f.children.splice(d,1),h.push(f),this._condense(h),this;e||f.leaf||!n(f.bbox,g)?c?(b++,f=c.children[b],e=!1):f=null:(h.push(f),i.push(b),b=0,c=f,f=f.children[0])}return this},toBBox:function(a){return a},compareMinX:function(a,b){return a[0]-b[0]},compareMinY:function(a,b){return a[1]-b[1]},toJSON:function(){return this.data},fromJSON:function(a){return this.data=a,this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,e){var f,g=c-b+1,h=this._maxEntries;if(h>=g)return f={children:a.slice(b,c+1),height:1,bbox:null,leaf:!0},d(f,this.toBBox),f;e||(e=Math.ceil(Math.log(g)/Math.log(h)),h=Math.ceil(g/Math.pow(h,e-1))),f={children:[],height:e,bbox:null,leaf:!1};var i,j,k,l,m=Math.ceil(g/h),n=m*Math.ceil(Math.sqrt(h));for(p(a,b,c,n,this.compareMinX),i=b;c>=i;i+=n)for(k=Math.min(i+n-1,c),p(a,i,k,m,this.compareMinY),j=i;k>=j;j+=m)l=Math.min(j+m-1,k),f.children.push(this._build(a,j,l,e-1));return d(f,this.toBBox),f},_chooseSubtree:function(a,b,c,d){for(var e,f,g,h,i,k,m,n;;){if(d.push(b),b.leaf||d.length-1===c)break;for(m=n=1/0,e=0,f=b.children.length;f>e;e++)g=b.children[e],i=j(g.bbox),k=l(a,g.bbox)-i,n>k?(n=k,m=m>i?i:m,h=g):k===n&&m>i&&(m=i,h=g);b=h}return b},_insert:function(a,b,c){var d=this.toBBox,e=c?a.bbox:d(a),f=[],h=this._chooseSubtree(e,this.data,b,f);for(h.children.push(a),g(h.bbox,e);b>=0&&f[b].children.length>this._maxEntries;)this._split(f,b),b--;this._adjustParentBBoxes(e,f,b)},_split:function(a,b){var c=a[b],e=c.children.length,f=this._minEntries;this._chooseSplitAxis(c,f,e);var g=this._chooseSplitIndex(c,f,e),h={children:c.children.splice(g,c.children.length-g),height:c.height,bbox:null,leaf:!1};c.leaf&&(h.leaf=!0),d(c,this.toBBox),d(h,this.toBBox),b?a[b-1].children.push(h):this._splitRoot(c,h)},_splitRoot:function(a,b){this.data={children:[a,b],height:a.height+1,bbox:null,leaf:!1},d(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var d,f,g,h,i,k,l,n;for(k=l=1/0,d=b;c-b>=d;d++)f=e(a,0,d,this.toBBox),g=e(a,d,c,this.toBBox),h=m(f,g),i=j(f)+j(g),k>h?(k=h,n=d,l=l>i?i:l):h===k&&l>i&&(l=i,n=d);return n},_chooseSplitAxis:function(a,b,c){var d=a.leaf?this.compareMinX:h,e=a.leaf?this.compareMinY:i,f=this._allDistMargin(a,b,c,d),g=this._allDistMargin(a,b,c,e);g>f&&a.children.sort(d)},_allDistMargin:function(a,b,c,d){a.children.sort(d);var f,h,i=this.toBBox,j=e(a,0,b,i),l=e(a,c-b,c,i),m=k(j)+k(l);for(f=b;c-b>f;f++)h=a.children[f],g(j,a.leaf?i(h):h.bbox),m+=k(j);for(f=c-b-1;f>=b;f--)h=a.children[f],g(l,a.leaf?i(h):h.bbox),m+=k(l);return m},_adjustParentBBoxes:function(a,b,c){for(var d=c;d>=0;d--)g(b[d].bbox,a)},_condense:function(a){for(var b,c=a.length-1;c>=0;c--)0===a[c].children.length?c>0?(b=a[c-1].children,b.splice(b.indexOf(a[c]),1)):this.clear():d(a[c],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0])),this.compareMinY=new Function("a","b",b.join(a[1])),this.toBBox=new Function("a","return [a"+a.join(", a")+"];")}},"function"==typeof a&&a.amd?a("rbush",function(){return b}):"undefined"!=typeof c?c.exports=b:"undefined"!=typeof self?self.rbush=b:window.rbush=b}()},{}],3:[function(b,c,d){!function(){function b(a,b){function c(b){var c,d=a.arcs[0>b?~b:b],e=d[0];return a.transform?(c=[0,0],d.forEach(function(a){c[0]+=a[0],c[1]+=a[1]})):c=d[d.length-1],0>b?[c,e]:[e,c]}function d(a,b){for(var c in a){var d=a[c];delete b[d.start],delete d.start,delete d.end,d.forEach(function(a){e[0>a?~a:a]=1}),h.push(d)}}var e={},f={},g={},h=[],i=-1;return b.forEach(function(c,d){var e,f=a.arcs[0>c?~c:c];f.length<3&&!f[1][0]&&!f[1][1]&&(e=b[++i],b[i]=c,b[d]=e)}),b.forEach(function(a){var b,d,e=c(a),h=e[0],i=e[1];if(b=g[h])if(delete g[b.end],b.push(a),b.end=i,d=f[i]){delete f[d.start];var j=d===b?b:b.concat(d);f[j.start=b.start]=g[j.end=d.end]=j}else f[b.start]=g[b.end]=b;else if(b=f[i])if(delete f[b.start],b.unshift(a),b.start=h,d=g[h]){delete g[d.end];var k=d===b?b:d.concat(b);f[k.start=d.start]=g[k.end=b.end]=k}else f[b.start]=g[b.end]=b;else b=[a],f[b.start=h]=g[b.end=i]=b}),d(g,f),d(f,g),b.forEach(function(a){e[0>a?~a:a]||h.push([a])}),h}function d(a,c,d){function e(a){var b=0>a?~a:a;(k[b]||(k[b]=[])).push({i:a,g:j})}function f(a){a.forEach(e)}function g(a){a.forEach(f)}function h(a){"GeometryCollection"===a.type?a.geometries.forEach(h):a.type in l&&(j=a,l[a.type](a.arcs))}var i=[];if(arguments.length>1){var j,k=[],l={LineString:f,MultiLineString:g,Polygon:g,MultiPolygon:function(a){a.forEach(g)}};h(c),k.forEach(arguments.length<3?function(a){i.push(a[0].i)}:function(a){d(a[0].g,a[a.length-1].g)&&i.push(a[0].i)})}else for(var m=0,n=a.arcs.length;n>m;++m)i.push(m);return{type:"MultiLineString",arcs:b(a,i)}}function e(a,c){function d(a){a.forEach(function(b){b.forEach(function(b){(f[b=0>b?~b:b]||(f[b]=[])).push(a)})}),g.push(a)}function e(b){return m(h(a,{type:"Polygon",arcs:[b]}).coordinates[0])>0}var f={},g=[],i=[];return c.forEach(function(a){"Polygon"===a.type?d(a.arcs):"MultiPolygon"===a.type&&a.arcs.forEach(d)}),g.forEach(function(a){if(!a._){var b=[],c=[a];for(a._=1,i.push(b);a=c.pop();)b.push(a),a.forEach(function(a){a.forEach(function(a){f[0>a?~a:a].forEach(function(a){a._||(a._=1,c.push(a))})})})}}),g.forEach(function(a){delete a._}),{type:"MultiPolygon",arcs:i.map(function(c){var d=[];if(c.forEach(function(a){a.forEach(function(a){a.forEach(function(a){f[0>a?~a:a].length<2&&d.push(a)})})}),d=b(a,d),(n=d.length)>1)for(var g,h=e(c[0][0]),i=0;i<n;++i)if(h===e(d[i])){g=d[0],d[0]=d[i],d[i]=g;break}return d})}}function f(a,b){return"GeometryCollection"===b.type?{type:"FeatureCollection",features:b.geometries.map(function(b){return g(a,b)})}:g(a,b)}function g(a,b){var c={type:"Feature",id:b.id,properties:b.properties||{},geometry:h(a,b)};return null==b.id&&delete c.id,c}function h(a,b){function c(a,b){b.length&&b.pop();for(var c,d=k[0>a?~a:a],e=0,f=d.length;f>e;++e)b.push(c=d[e].slice()),j(c,e);0>a&&i(b,f)}function d(a){return a=a.slice(),j(a,0),a}function e(a){for(var b=[],d=0,e=a.length;e>d;++d)c(a[d],b);return b.length<2&&b.push(b[0].slice()),b}function f(a){for(var b=e(a);b.length<4;)b.push(b[0].slice());return b}function g(a){return a.map(f)}function h(a){var b=a.type;return"GeometryCollection"===b?{type:b,geometries:a.geometries.map(h)}:b in l?{type:b,coordinates:l[b](a)}:null}var j=r(a.transform),k=a.arcs,l={Point:function(a){return d(a.coordinates)},MultiPoint:function(a){return a.coordinates.map(d)},LineString:function(a){return e(a.arcs)},MultiLineString:function(a){return a.arcs.map(e)},Polygon:function(a){return g(a.arcs)},MultiPolygon:function(a){return a.arcs.map(g)}};return h(b)}function i(a,b){for(var c,d=a.length,e=d-b;e<--d;)c=a[e],a[e++]=a[d],a[d]=c}function j(a,b){for(var c=0,d=a.length;d>c;){var e=c+d>>>1;a[e]<b?c=e+1:d=e}return c}function k(a){function b(a,b){a.forEach(function(a){0>a&&(a=~a);var c=e[a];c?c.push(b):e[a]=[b]})}function c(a,c){a.forEach(function(a){b(a,c)})}function d(a,b){"GeometryCollection"===a.type?a.geometries.forEach(function(a){d(a,b)}):a.type in g&&g[a.type](a.arcs,b)}var e={},f=a.map(function(){return[]}),g={LineString:b,MultiLineString:c,Polygon:c,MultiPolygon:function(a,b){a.forEach(function(a){c(a,b)})}};a.forEach(d);for(var h in e)for(var i=e[h],k=i.length,l=0;k>l;++l)for(var m=l+1;k>m;++m){var n,o=i[l],p=i[m];(n=f[o])[h=j(n,p)]!==p&&n.splice(h,0,p),(n=f[p])[h=j(n,o)]!==o&&n.splice(h,0,o)}return f}function l(a,b){function c(a){f.remove(a),a[1][2]=b(a),f.push(a)}var d=r(a.transform),e=s(a.transform),f=q();return b||(b=o),a.arcs.forEach(function(a){for(var g,h,i=[],j=0,k=0,l=a.length;l>k;++k)h=a[k],d(a[k]=[h[0],h[1],1/0],k);for(var k=1,l=a.length-1;l>k;++k)g=a.slice(k-1,k+2),g[1][2]=b(g),i.push(g),f.push(g);for(var k=0,l=i.length;l>k;++k)g=i[k],g.previous=i[k-1],g.next=i[k+1];for(;g=f.pop();){var m=g.previous,n=g.next;g[1][2]<j?g[1][2]=j:j=g[1][2],m&&(m.next=n,m[2]=g[2],c(m)),n&&(n.previous=m,n[0]=g[0],c(n))}a.forEach(e)}),a}function m(a){for(var b,c=-1,d=a.length,e=a[d-1],f=0;++c<d;)b=e,e=a[c],f+=b[0]*e[1]-b[1]*e[0];return.5*f}function o(a){var b=a[0],c=a[1],d=a[2];return Math.abs((b[0]-d[0])*(c[1]-b[1])-(b[0]-c[0])*(d[1]-b[1]))}function p(a,b){return a[1][2]-b[1][2]}function q(){function a(a,b){for(;b>0;){var c=(b+1>>1)-1,e=d[c];if(p(a,e)>=0)break;d[e._=b]=e,d[a._=b=c]=a}}function b(a,b){for(;;){var c=b+1<<1,f=c-1,g=b,h=d[g];if(e>f&&p(d[f],h)<0&&(h=d[g=f]),e>c&&p(d[c],h)<0&&(h=d[g=c]),g===b)break;d[h._=b]=h,d[a._=b=g]=a}}var c={},d=[],e=0;return c.push=function(b){return a(d[b._=e]=b,e++),e},c.pop=function(){if(!(0>=e)){var a,c=d[0];return--e>0&&(a=d[e],b(d[a._=0]=a,0)),c}},c.remove=function(c){var f,g=c._;if(d[g]===c)return g!==--e&&(f=d[e],(p(f,c)<0?a:b)(d[f._=g]=f,g)),g},c}function r(a){if(!a)return t;var b,c,d=a.scale[0],e=a.scale[1],f=a.translate[0],g=a.translate[1];return function(a,h){h||(b=c=0),a[0]=(b+=a[0])*d+f,a[1]=(c+=a[1])*e+g}}function s(a){if(!a)return t;var b,c,d=a.scale[0],e=a.scale[1],f=a.translate[0],g=a.translate[1];return function(a,h){h||(b=c=0);var i=(a[0]-f)/d|0,j=(a[1]-g)/e|0;a[0]=i-b,a[1]=j-c,b=i,c=j}}function t(){}var u={version:"1.6.19",mesh:function(a){return h(a,d.apply(this,arguments))},meshArcs:d,merge:function(a){return h(a,e.apply(this,arguments))},mergeArcs:e,feature:f,neighbors:k,presimplify:l};"function"==typeof a&&a.amd?a(u):"object"==typeof c&&c.exports?c.exports=u:this.topojson=u}()},{}],4:[function(a,b,c){!function(a){var b=function(a){var b=a.backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/b}(a),c=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c)},d={fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"};1!==b&&(c(d,function(c,d){a[d]=function(a){return function(){var d,e,f=Array.prototype.slice.call(arguments);if("all"===c)f=f.map(function(a){return a*b});else if(Array.isArray(c))for(d=0,e=c.length;e>d;d++)f[c[d]]*=b;return a.apply(this,f)}}(a[d])}),a.stroke=function(a){return function(){this.lineWidth*=b,a.apply(this,arguments),this.lineWidth/=b}}(a.stroke),a.fillText=function(a){return function(){var c=Array.prototype.slice.call(arguments);c[1]*=b,c[2]*=b,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(a,c,d){return c*b+d}),a.apply(this,c),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(a,c,d){return c/b+d})}}(a.fillText),a.strokeText=function(a){return function(){var c=Array.prototype.slice.call(arguments);c[1]*=b,c[2]*=b,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(a,c,d){return c*b+d}),a.apply(this,c),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(a,c,d){return c/b+d})}}(a.strokeText))}(CanvasRenderingContext2D.prototype)},{}],5:[function(a,b,c){!function(a){a.getContext=function(a){return function(b){var c,d,e=a.call(this,b);return this.polyfillApplied?e:("2d"===b&&(c=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,d=(window.devicePixelRatio||1)/c,d>1&&(this.style.height=this.height+"px",this.style.width=this.width+"px",this.width*=d,this.height*=d),this.polyfillApplied=!0),e)}}(a.getContext)}(HTMLCanvasElement.prototype)},{}],6:[function(a,b,c){"use strict";a("./HTMLCanvasPolyfill.js"),a("./CanvasRenderingContextPolyfill.js");var d=a("./renderingInterface"),e=a("topojson"),f=a("rbush"),g=a("ensure-array");b.exports=L.TileLayer.Canvas.extend({options:{async:!0},initialize:function(a,b){var c=this;L.TileLayer.Canvas.prototype.initialize.call(this,b),this._tileCache={},this._features={},this._renderers=[],this.featureId=b.featureId||function(a){return a.properties.id},"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),this.setUrl(a),this.on("tileunload",function(a){var b=a.tile._tilePoint.x+":"+a.tile._tilePoint.y,d=c._activeLayers(a.tile);d.forEach(function(d){for(var e=a.tile._layers[d],f=e.features.length-1;f>=0;f--){var g=e.features[f],h=c.featureId(g);c._features[h]&&(delete c._features[h].tiles[b],0===Object.keys(c._features[h].tiles).length&&delete c._features[h])}}),a.tile.abort&&a.tile.abort(),a.tile.abort=null})},onAdd:function(a){L.TileLayer.Canvas.prototype.onAdd.call(this,a),this.options.onclick&&"function"==typeof this.options.onclick&&(this.clickHandler=this.handleClick.bind(this),a.on("click",this.clickHandler)),this.options.onmousemove&&"function"==typeof this.options.onmousemove&&(this.mouseMoveHandler=this.handleMouseMove.bind(this),a.on("mousemove",this.mouseMoveHandler))},onRemove:function(a){L.TileLayer.Canvas.prototype.onRemove.call(this,a),this.clickHandler&&a.off("click",this.clickHandler),a.off("click",this.clickHandler),this.mouseMoveHandler&&a.off("mousemove",this.mouseMoveHandler)},handleClick:function(a){var b=this.featuresAt(a);this.options.onclick(a,b,this)},handleMouseMove:function(a){var b=this.featuresAt(a);this.options.onmousemove(a,b,this)},featuresAt:function(a){var b,c=this,d=(performance.now(),this._getTileKey(a.latlng,map.getZoom())),e=this._tiles[d],g=this._getPixelRatio(e);if(!e)return[];if(!e._layers)return[];var h=Object.keys(e._layers);if(!e._spatialIndex){e._spatialIndex=f(9);var i=[];h.forEach(function(a){for(b=e._layers[a].features.length-1;b>=0;b--){var d=e._layers[a].features[b];d.layer=a;var f=turf.extent(d);f[0]=f[0]/c.layerExtents[d.layer]*e.width,f[1]=f[1]/c.layerExtents[d.layer]*e.height,f[2]=f[2]/c.layerExtents[d.layer]*e.width,f[3]=f[3]/c.layerExtents[d.layer]*e.height,f.push(d),i.push(f)}}),e._spatialIndex.load(i)}var j=a.layerPoint.x-e._leaflet_pos.x,k=a.layerPoint.y-e._leaflet_pos.y;j*=g,k*=g;for(var i=e._spatialIndex.search([j,k,j,k]),l=[],b=i.length-1;b>=0;b--){var m=i[b][4],n=j/e.width*c.layerExtents[m.layer],o=k/e.height*c.layerExtents[m.layer],p=turf.point([n,o]);if("Polygon"===m.geometry.type||"MultiPolygon"===m.geometry.type)turf.inside(p,m)&&l.push(c._features[c.featureId(m)]);else if("LineString"===m.geometry.type){var q=this._getDistanceFromLine(p.geometry.coordinates,m.geometry.coordinates);q=q/c.layerExtents[m.layer]*e.width,5>q&&l.push(c._features[c.featureId(m)])}}return l},_getTileKey:function(a,b){var c=parseInt(Math.floor((a.lng+180)/360*(1<<b))),d=parseInt(Math.floor((1-Math.log(Math.tan(a.lat.toRad())+1/Math.cos(a.lat.toRad()))/Math.PI)/2*(1<<b)));return[c,d].join(":")},_getDistanceFromLine:function(a,b){var c=Number.POSITIVE_INFINITY;if(b&&b.length>1){a=L.point(a[0],a[1]);for(var d=0,e=b.length-1;e>d;d++){var f=this._projectPointOnLineSegment(a,b[d],b[d+1]);f.distance<=c&&(c=f.distance)}}return c},_projectPointOnLineSegment:function(a,b,c){b=L.point(b[0],b[1]),c=L.point(c[0],c[1]);var d=b.distanceTo(c);if(1>d)return{distance:a.distanceTo(b),coordinate:b};var e=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/Math.pow(d,2);if(1e-7>e)return{distance:a.distanceTo(b),coordinate:b};if(e>.9999999)return{distance:a.distanceTo(c),coordinate:c};var f=L.point(b.x+e*(c.x-b.x),b.y+e*(c.y-b.y));return{distance:a.distanceTo(f),point:f}},projector:function(a,b,c){var d=Math.pow(2,a.z),e=40075016.68557849,f=e/d,g=a.x%d,h=a.y%d,i={top:e/2-(h+1)/d*e,left:-(e/2)+g/d*e};return i.bottom=i.top+f,i.right=i.left+f,d3.geo.transform({point:function(a,b){var d=L.CRS.EPSG3857.project({lat:b,lng:a});d.x=(d.x-i.left)/f,d.y=1-(d.y-i.top)/f,d.x*=c,d.y*=c,this.stream.point(d.x,d.y)}})},clippedProjector:function(a,b,c,d){var e=this.projector(a,b,c,d),f=d3.geo.clipExtent().extent([[-8,-8],[c+8,c+8]]);return{stream:function(a){return e.stream(f.stream(a))}}},_fetchTile:function(a,b){var c=this._url+"@@"+JSON.stringify(a);if("function"==typeof this._tileCache[c])return this._tileCache[c](b),function(){};var d=this,e=this.getTileUrl(a),f=[];return this.fetch(e,function(a,c){a||(c=d.parse(c),f.forEach(function(a){a(null,c)})),b(a,c)})},render:function(a,b){if("function"==typeof b)return this._renderers.push({layer:a,run:b}),this;var c=new d(this,a);return this._renderers.push({layer:a,run:c.run.bind(c)}),c},drawData:function(a,b,c,d){var e=a.getContext("2d"),f=a.width;e.clearRect(0,0,f,f);var g=this._getPixelRatio(a),h={};if(this._renderers.length){var i=this;this._renderers.forEach(function(a){c[a.layer]&&("undefined"==typeof h[a.layer]&&(h[a.layer]=d3.geo.path().projection(i.clippedProjector(b,a.layer,f,g)).context(e)),a.run(e,c[a.layer].features,b,function(b){"object"!=typeof b||Array.isArray(b)||(b=[b]),e.beginPath(),b.forEach(h[a.layer])}))}),d()}else d(new Error("No renderer specified!"))},drawTile:function(a,b,c){function d(){var c=(performance.now(),document.createElement("canvas"));c.width=f.options.tileSize,c.height=f.options.tileSize,f.drawData(c,b,a._layers,function(b){if(e&&window.cancelAnimationFrame(e),e=window.requestAnimationFrame(function(){a.getContext("2d").drawImage(c,0,0),f.tileDrawn(a)}),b)throw b})}if("undefined"==typeof this._url)return void this.tileDrawn(a);var e,f=(performance.now(),this);this._adjustTilePoint(b),a._layers?d():a.abort=this._fetchTile(b,function(c,e){if(c)throw f.tileDrawn(a),c;a._layers=f._filterLayers(e);var g=f._activeLayers(a),h=b.x+":"+b.y;g.forEach(function(b){for(var c=a._layers[b],d=c.features.length-1;d>=0;d--){var e=c.features[d],g=f.featureId(e);if(f._features[g])f._features[g].tiles[h]=!0;else{var i={};i[h]=!0,f._features[g]={id:g,properties:e.properties,tiles:i}}}}),d()})},redrawTile:function(a){var b=this._tiles[a];if(b){var c=(b.getContext("2d"),a.split(":"));this.drawTile(b,{x:c[0],y:c[1]},this._map.getZoom())}},redrawFeatures:function(a){a=g(a);var b,c=this,d={};a.forEach(function(a){var e=a&&c.featureId(a);if(c._features[e]){var f=c._features[e].tiles;for(b in f)d[b]=!0}});for(b in d)c.redrawTile(b)},_filterLayers:function(a){if(!this.options.layers)return a;var b={};return this.options.layers.forEach(function(c){b[c]=a[c]}),b},_activeLayers:function(a){if(!this.options.layers)return Object.keys(a._layers);var b=[];for(var c in a._layers)this.options.layers[c]&&b.push(c);return b},_getPixelRatio:function(a){var b=a.backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/b}}),b.exports.json=b.exports.extend({fetch:function(a,b){var c=d3.json(a,function(a,c){b(a,c.response||c)});return c.abort.bind(c)}}),b.exports.geojson=b.exports.json.extend({parse:function(a){return{geojson:a}}}),b.exports.topojson=b.exports.json.extend({parse:function(a){var b={};for(var c in a.objects)b[c]=e.feature(a,a.objects[c]);return b}}),b.exports.mvt=b.exports.extend({fetch:function(a,b){var c=d3.xhr(a).responseType("arraybuffer").get(function(a,c){b(a,c.response||c)});return c.abort.bind(c)},parse:function(a){var b=new VectorTile(new pbf(new Uint8Array(a))),c={};"undefined"==typeof this.layerExtents&&(this.layerExtents={});for(var d in b.layers)this.layerExtents[d]=b.layers[d].extent,c[d]=b.layers[d].toGeoJSON();return c},projector:function(a,b,c,d){var e=this;return d3.geo.transform({point:function(a,f){a=a/e.layerExtents[b]*c,f=f/e.layerExtents[b]*c,a/=d,f/=d,this.stream.point(a,f)}})}})},{"./CanvasRenderingContextPolyfill.js":4,"./HTMLCanvasPolyfill.js":5,"./renderingInterface":7,"ensure-array":1,rbush:2,topojson:3}],7:[function(a,b,c){var d=function(a,b){this.layer=a,this.layerName=b,this.instructions=[],this.whereConditions=[];var c=this;Object.keys(a.__proto__).forEach(function(b){c[b]=function(){return a[b].apply(a,arguments)}}),["render","data","mode","addTo"].forEach(function(b){c[b]=function(){return a[b].apply(a,arguments)}})};d.prototype.minZoom=function(a){return this.minZoom=a,this},d.prototype.maxZoom=function(a){return this.maxZoom=a,this},d.prototype.fill=function(a){return this.instructions.push({type:"fill",color:a}),this},d.prototype.stroke=function(a,b){return this.instructions.push({type:"stroke",width:a,color:b}),this},d.prototype.fillBy=function(a,b,c){return this.fill(function(d){return b[d.properties[a]]||c}),this},d.prototype.strokeBy=function(a,b,c){return this.stroke(function(d){return b[d.properties[a]]||c}),this},d.prototype._where=function(a){var b=a.field,c=a.value;if("undefined"==typeof c)if("string"==typeof b)this.where(function(a){return a.properties[b]?!0:!1},void 0,a.invert);else if("object"==typeof b)for(var d in b)this.where(d,b[d],a.invert);else{if("function"!=typeof b)throw new Error("with RenderingInterface.where(field, value) if value is undefined then field must be a string, object, or function!");if(a.invert){var e=b;b=function(){return!e.apply(null,arguments)}}this.whereConditions.push(b)}else if("string"==typeof c||"number"==typeof c)this.where(function(a){return a.properties[b]==c},void 0,a.invert);else{if("object"!=typeof c||!Array.isArray(c))throw new Error("RenderingInterface.where(field, value) cannot be called with field as type "+typeof b+" and value as type "+typeof c);this.where(function(a){return-1!=c.indexOf(a.properties[b])},void 0,a.invert)}return this},d.prototype.where=function(a,b,c){return this._where({field:a,value:b,invert:c})},d.prototype.whereNot=function(a,b){return this._where({field:a,value:b,invert:!0})},d.prototype.run=function(a,b,c,d){"number"==typeof this.minZoom&&c.z<this.minZoom||"number"==typeof this.maxZoom&&c.z>this.maxZoom||(this.whereConditions.forEach(function(a){b=b.filter(a)}),this.instructions.forEach(function(c){if("fill"==c.type)if("string"==typeof c.color)a.fillStyle=c.color,d(b),a.fill();else{if("function"!=typeof c.color)throw new Error("fill color must be string or function, is type "+typeof c.color);b.forEach(function(b){a.fillStyle=c.color(b),d(b),a.fill()})}else if("stroke"==c.type)if("number"==typeof c.width&&"string"==typeof c.color)a.lineWidth=c.width,a.strokeStyle=c.color,d(b),a.stroke();else{if("function"!=typeof c.width&&"function"!=typeof c.color)throw new Error("Expected stroke(number or function, string or function) or stroke(function), got stroke("+typeof c.width+", "+typeof c.color+")");b.forEach(function(b){var e="function"==typeof c.width?c.width(b):c.width,f="function"==typeof c.color?c.color(b):c.color;"undefined"==typeof c.color&&Array.isArray(e)&&(f=e[1],e=e[0]),a.lineWidth=e,a.strokeStyle=f,d(b),a.stroke()})}}))},b.exports=d},{}]},{},[6])(6)});